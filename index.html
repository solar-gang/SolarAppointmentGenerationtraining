<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>LOS • Bill Training (Slide Show)</title>
  <meta name="theme-color" content="#0B1C2D"/>

  <style>
    :root{
      --navy:#0B1C2D;
      --navy2:#102C46;
      --gold:#FBC909;
      --teal:#3AADBB;

      --bg:#F6F8FB;
      --card:#FFFFFF;
      --text:#0C1220;
      --muted:#5B667A;
      --line:rgba(16,24,40,.10);

      --shadow: 0 18px 55px rgba(11, 28, 45, .14);
      --shadow2: 0 10px 26px rgba(11,28,45,.10);

      --r:16px;
      --r2:22px;

      --safeT: env(safe-area-inset-top);
      --safeB: env(safe-area-inset-bottom);
      --safeL: env(safe-area-inset-left);
      --safeR: env(safe-area-inset-right);

      --max: 1320px;
      --g: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1200px 800px at 15% 0%, rgba(58,173,187,.12), transparent 60%),
        radial-gradient(1200px 800px at 90% 10%, rgba(251,201,9,.12), transparent 60%),
        var(--bg);
      color:var(--text);
      padding: calc(14px + var(--safeT)) calc(14px + var(--safeR)) calc(14px + var(--safeB)) calc(14px + var(--safeL));
    }

    .wrap{max-width:var(--max); margin:0 auto}

    /* Top bar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.84);
      backdrop-filter: blur(10px);
      border-radius: var(--r2);
      box-shadow: var(--shadow2);
      position: sticky;
      top: calc(10px + var(--safeT));
      z-index: 50;
    }
    .brand{display:flex; align-items:center; gap:12px; min-width: 0;}
    .brand img{height:34px; width:auto; display:block}
    .brand .t{min-width:0}
    .brand .t b{display:block; font-size:14px; letter-spacing:.2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .brand .t span{display:block; font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    .btn{
      appearance:none; border:1px solid var(--line);
      background: #fff;
      padding:10px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 13px;
      cursor:pointer;
      box-shadow: 0 6px 14px rgba(11,28,45,.06);
      display:inline-flex; gap:8px; align-items:center;
      user-select:none;
      white-space:nowrap;
    }
    .btn.primary{
      background: linear-gradient(135deg, var(--gold), #ffe37a);
      border-color: rgba(251,201,9,.35);
      color: var(--navy);
    }
    .btn.ghost{
      background: rgba(255,255,255,.65);
    }
    .btn:active{transform: translateY(1px)}
    .btn:disabled{opacity:.5; cursor:not-allowed; transform:none}

    .progress{
      display:flex; align-items:center; gap:10px;
      min-width: 220px;
      justify-content:flex-end;
    }
    .bar{
      height:10px; width:140px;
      border-radius: 999px;
      background: rgba(11,28,45,.10);
      overflow:hidden;
      border:1px solid rgba(16,24,40,.08);
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--teal), var(--gold));
      border-radius: 999px;
      transition: width .25s ease;
    }
    .pct{
      font-weight:900;
      font-size:12px;
      color: var(--navy);
      min-width: 48px;
      text-align:right;
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 300px 1fr;
      gap: var(--g);
      margin-top: 14px;
    }
    @media (max-width: 1020px){
      .grid{grid-template-columns: 1fr}
    }

    /* Sidebar */
    .sidebar{
      border:1px solid var(--line);
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      border-radius: var(--r2);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .sideHead{
      padding:14px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .sideHead b{font-size:13px; letter-spacing:.2px; color:var(--navy)}
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(58,173,187,.28);
      background: rgba(58,173,187,.10);
      color: var(--navy);
      font-weight: 900;
      white-space:nowrap;
    }
    .nav{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .navItem{
      width:100%;
      text-align:left;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(16,24,40,.08);
      background:#fff;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(11,28,45,.06);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .navItem b{font-size:13px; color:var(--navy); display:block}
    .navItem small{font-size:12px; color:var(--muted); display:block; margin-top:2px}
    .navItem.active{
      border-color: rgba(58,173,187,.35);
      box-shadow: 0 12px 24px rgba(58,173,187,.18);
      outline: 2px solid rgba(58,173,187,.16);
    }
    .navItem .tag{
      flex:0 0 auto;
      font-size:11px;
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(251,201,9,.40);
      background: rgba(251,201,9,.12);
      color: var(--navy);
      font-weight: 1000;
      white-space:nowrap;
      min-width: 34px;
      text-align:center;
    }

    /* Slide */
    .slide{
      border:1px solid var(--line);
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .slideHead{
      padding:16px 16px 12px 16px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .slideHead h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
      color: var(--navy);
    }
    .slideHead p{
      margin:6px 0 0 0;
      font-size:13px;
      color: var(--muted);
      max-width: 90ch;
    }
    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(58,173,187,.28);
      background: rgba(58,173,187,.10);
      color: var(--navy);
      font-weight: 1000;
      font-size: 12px;
      white-space:nowrap;
    }

    .twoCol{
      padding:16px;
      display:grid;
      grid-template-columns: 1.15fr .95fr;
      gap: var(--g);
      align-items:start;
    }
    @media (max-width: 1020px){
      .twoCol{grid-template-columns: 1fr}
    }

    /* Bill image panel */
    .imgCard{
      border-radius: var(--r);
      overflow:hidden;
      border:1px solid var(--line);
      background:#fff;
      box-shadow: var(--shadow2);
      position: relative;
    }
    .imgTools{
      position:absolute;
      top:10px; left:10px;
      display:flex; gap:8px;
      z-index: 5;
    }
    .chip{
      border:1px solid rgba(255,255,255,.25);
      background: rgba(11,28,45,.78);
      color:#fff;
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight: 950;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(8px);
    }
    .chip:active{transform: translateY(1px)}
    .imgCard img{
      width:100%;
      height:auto;
      display:block;
    }

    /* Callouts (right side) */
    .panel{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .card{
      border-radius: var(--r);
      border:1px solid var(--line);
      background:#fff;
      box-shadow: var(--shadow2);
      padding: 14px;
    }
    .card h3{
      margin:0 0 10px 0;
      font-size: 12px;
      letter-spacing:.2px;
      color: var(--navy);
      text-transform: uppercase;
    }
    .numList{
      margin:0;
      padding:0;
      list-style:none;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .numItem{
      display:grid;
      grid-template-columns: 34px 1fr;
      gap:10px;
      align-items:flex-start;
      padding:10px 10px;
      border-radius: 14px;
      border:1px solid rgba(16,24,40,.08);
      background: linear-gradient(180deg, #fff, #fff);
    }
    .bubble{
      width:34px; height:34px;
      border-radius: 12px;
      display:flex; align-items:center; justify-content:center;
      font-weight: 1000;
      color: var(--navy);
      border:1px solid rgba(58,173,187,.30);
      background: linear-gradient(135deg, rgba(58,173,187,.18), rgba(251,201,9,.16));
      box-shadow: 0 8px 16px rgba(11,28,45,.08);
      flex:0 0 auto;
    }
    .numItem b{
      display:block;
      font-size: 13px;
      color: var(--navy);
      letter-spacing:.1px;
      margin-bottom: 4px;
    }
    .numItem p{
      margin:0;
      font-size: 12.8px;
      color: var(--muted);
      line-height: 1.45;
    }
    .tip{
      margin-top: 10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(251,201,9,.30);
      background: rgba(251,201,9,.10);
      color: var(--navy);
      font-weight: 900;
      font-size: 12px;
      line-height: 1.35;
    }

    .navBar{
      padding:12px 16px 16px 16px;
      border-top: 1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      background: rgba(255,255,255,.72);
    }
    .counter{
      font-size:12px;
      color: var(--muted);
      font-weight:800;
    }

    /* Quiz */
    .quizGrid{
      padding:16px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .q{
      border-radius: var(--r);
      border:1px solid var(--line);
      background:#fff;
      box-shadow: var(--shadow2);
      padding: 14px;
    }
    .q h4{
      margin:0 0 8px 0;
      font-size: 14px;
      color: var(--navy);
    }
    .choices{
      display:flex;
      flex-direction:column;
      gap: 8px;
      margin-top: 10px;
    }
    .choice{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding:10px 10px;
      border-radius: 14px;
      border:1px solid rgba(16,24,40,.10);
      background: #fff;
      cursor:pointer;
      user-select:none;
    }
    .choice input{margin-top: 2px}
    .choice span{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
    }
    .result{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px;
      border-radius: var(--r2);
      border:1px solid rgba(58,173,187,.30);
      background: rgba(58,173,187,.10);
      color: var(--navy);
      font-weight: 1000;
    }
    .ok{
      border-color: rgba(52,199,89,.35);
      background: rgba(52,199,89,.10);
    }
    .bad{
      border-color: rgba(255,59,48,.25);
      background: rgba(255,59,48,.08);
    }

    /* Focus mode */
    .focus .sidebar{display:none}
    .focus .grid{grid-template-columns: 1fr}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <!-- Use your repo logo filename here. In your screenshot you have Logo.png -->
        <img src="Logo.png" alt="LOS logo">
        <div class="t">
          <b>LOS • Bill Reading Training</b>
          <span>1 slide per bill page • bill left • numbered callouts right • top → bottom</span>
        </div>
      </div>

      <div class="progress" title="Quiz completion">
        <div class="bar"><div id="barFill"></div></div>
        <div class="pct" id="pct">0%</div>
      </div>

      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end">
        <button class="btn ghost" id="toggleFocus">Focus</button>
        <button class="btn" id="openImgBtn">Open Bill</button>
        <button class="btn" id="prevBtn">Back</button>
        <button class="btn primary" id="nextBtn">Next</button>
      </div>
    </div>

    <div class="grid" id="grid">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sideHead">
          <b>Slides</b>
          <span class="pill" id="pill">—</span>
        </div>
        <div class="nav" id="nav"></div>
      </aside>

      <!-- Slide -->
      <main class="slide" id="slide">
        <div class="slideHead">
          <div>
            <h1 id="title">—</h1>
            <p id="subtitle">—</p>
          </div>
          <div class="badge" id="badge">—</div>
        </div>

        <!-- Slide body (bill + callouts) -->
        <div class="twoCol" id="slideBody">
          <section class="imgCard">
            <div class="imgTools">
              <div class="chip" id="openNew">Open</div>
            </div>
            <img id="billImg" src="" alt="Bill image">
          </section>

          <section class="panel">
            <div class="card">
              <h3>Numbered callouts (read top → bottom)</h3>
              <ul class="numList" id="callouts"></ul>
              <div class="tip" id="tip">—</div>
            </div>
          </section>
        </div>

        <!-- Quiz body -->
        <div class="quizGrid" id="quizBody" style="display:none;">
          <div class="result bad" id="quizResult">
            <div>Quiz: <span id="quizScore">0 / 0</span></div>
            <div id="quizPct">0% complete</div>
          </div>
          <div id="questions"></div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
            <button class="btn" id="resetQuiz">Reset Quiz</button>
            <button class="btn primary" id="gradeQuiz">Grade Quiz</button>
          </div>
        </div>

        <div class="navBar">
          <div class="counter" id="counter">—</div>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end">
            <button class="btn" id="jumpQuiz">Jump to Quiz</button>
            <button class="btn primary" id="jumpSlides">Back to Slides</button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    /*
      =========================
      IMPORTANT: IMAGE FILENAMES
      =========================
      Use the EXACT filenames that exist in your GitHub repo root (or put them in /assets and update paths).
      From your screenshot you already have:
        - Scebill.jpeg
        - Add-on-bill2.jpeg
        - Add-on-bill3.jpeg
        - Yucaipa2.jpg
        - Yucaipa3.jpg
        - Logo.png
      You will also need to upload (or rename to match) these:
        - Yucaipa4.jpg        (if you want the Yucaipa page 4 slide)
        - Add-on-bill5.jpeg   (if you want the add-on page 5 slide)
        - Tiered-DCARE.jpg    (tiered bill image)
        - NEM3.jpg            (enhanced NEM 3.0 scan)
    */

    // =========================
    // SLIDES (1 slide per bill page)
    // =========================
    const slides = [
      {
        id:"addon-p1",
        badge:"ADD-ON • Page 1",
        title:"Add-On Bill — Annual / True-Up Summary (Page 1)",
        subtitle:"Teach the rep where the annual number lives and why monthly can be misleading.",
        img:"Scebill.jpeg", // <-- change if your add-on page 1 is named differently
        tip:"Rep goal: Point to the annual/settlement timing first, then explain why a customer can still owe with solar.",
        callouts:[
          {t:"Year-to-date charges (annual running total)", d:"This is the ‘big’ number that matters for the true-up. Customers often focus on the small monthly line and miss the annual total."},
          {t:"Billing month position (e.g., month 11 of 12)", d:"This tells you how close they are to settlement/true-up. The closer to month 12, the more urgent it is to review usage + credits."},
          {t:"Credit balance vs new charges (monthly snapshot)", d:"A credit on this page does NOT mean the year is safe. It just means this month netted out—true-up is still coming."},
          {t:"NEM / annual billing explanation box", d:"Use simple language: ‘They track credits during the year, then settle the remaining balance at the end of the 12-month cycle.’"},
          {t:"Annual bill / settled at end of billing period", d:"This is the customer pain point: the end-of-year bill is where any mismatch becomes real money."}
        ]
      },

      {
        id:"addon-p3",
        badge:"ADD-ON • Page 3",
        title:"Add-On Bill — TOU + Usage + Fees (Page 3)",
        subtitle:"Teach the rep how TOU timing + unavoidable fees create a remaining bill even with solar.",
        img:"Add-on-bill3.jpeg",
        tip:"Rep goal: Connect ‘when they use power’ + ‘fees that don’t go away’ to explain the remaining bill.",
        callouts:[
          {t:"Time-of-Use schedule (identify expensive window)", d:"Call out the peak window (often 4–9pm). Solar produces less there, so grid imports are usually highest and most expensive."},
          {t:"Past/current usage by TOU period", d:"Scan which bucket is biggest (off/mid/peak). If evening/peak is high, that’s usually the bill driver."},
          {t:"Net generation/export (are they building credits?)", d:"If export is low, credits won’t offset imports. This happens with added loads (EVs, pool, HVAC) or undersized systems."},
          {t:"Daily average usage trend (this year vs last)", d:"Usage creep is the silent killer. If the bars are trending up, the solar size might no longer match the home."},
          {t:"Details of new charges (Delivery + NBCs + taxes)", d:"Delivery and non-bypassable charges are common ‘still owe’ reasons. Reps should say: ‘Some charges remain even with solar.’"}
        ]
      },

      {
        id:"addon-p5",
        badge:"ADD-ON • Page 5",
        title:"Add-On Bill — Tracked Charges / YTD Detail (Page 5)",
        subtitle:"Teach the rep how SCE tracks consumption/generation totals and why it can still settle to a balance.",
        img:"54554574-345C-4150-9FA6-EBDDF036C667.jpeg", // <-- If this file name is different in your repo, change it.
        tip:"Rep goal: Use this page to prove the math—‘tracked totals’ explain the year-to-date result.",
        callouts:[
          {t:"Tracked delivery charges by TOU bucket", d:"These show how much energy cost is being assigned into each TOU period—timing drives the price."},
          {t:"Tracked generation charges by TOU bucket", d:"This shows what the utility charges to generate power. Even with solar, imported kWh still triggers these."},
          {t:"Energy charge total (current month)", d:"This is the actual cost for the billing period—use it to connect usage → charges."},
          {t:"Net consumption/generation info box", d:"This is your ‘proof section’—it summarizes YTD energy charges and current month totals."},
          {t:"Year-to-date kWh + year-to-date charges", d:"This is the clearest ‘why’ behind the true-up number—more total imported usage = higher settlement."}
        ]
      },

      {
        id:"yucaipa-p1",
        badge:"YUCAIPA • Page 1",
        title:"Yucaipa TOU Bill — Amount Due / Past Due + TOU (Page 1)",
        subtitle:"Teach the rep to separate ‘past due’ from ‘new charges’ and still read TOU correctly.",
        img:"Yucaipa2.jpg",
        tip:"Rep goal: Don’t blame solar here—first clarify what portion is old balance vs new charges.",
        callouts:[
          {t:"Amount due vs past due", d:"If past due exists, the total due is not purely ‘this month’. Explain: ‘Part is previous balance, part is new charges.’"},
          {t:"Account summary breakdown", d:"Read line-by-line: previous balance, payments received, past due amount, new charges, late fee (if any)."},
          {t:"Why customers feel surprised", d:"They see a large amount due and assume solar failed—reframe to ‘billing structure + timing + usage’."},
          {t:"TOU schedule summary", d:"Identify peak vs off-peak windows. Tell the customer: ‘Even with solar, peak imports are expensive.’"},
          {t:"Payment stub vs bill logic", d:"Make sure the rep doesn’t use the payment stub to explain usage—use the bill sections above."}
        ]
      },

      {
        id:"yucaipa-p3",
        badge:"YUCAIPA • Page 3",
        title:"Yucaipa TOU Bill — Usage by TOU + Cost Breakdown (Page 3)",
        subtitle:"Teach the rep how the bill assigns kWh into TOU buckets and converts it into dollars.",
        img:"Yucaipa3.jpg",
        tip:"Rep goal: Show the customer the most expensive bucket first, then explain how their usage pattern creates cost.",
        callouts:[
          {t:"Usage bars by TOU (kWh)", d:"Which bucket is biggest? On-peak and mid-peak cost more; a smaller kWh can still be a bigger dollar total."},
          {t:"Average cost per bucket", d:"This is the rate signal. Highlight: peak is higher. This is why shifting usage matters."},
          {t:"Total cost column", d:"This is the pain column. Even if off-peak is biggest, peak can still add up quickly."},
          {t:"Daily usage trend chart", d:"If trend is climbing, the home outgrew the system or added loads."},
          {t:"Details of new charges summary", d:"Use it to explain delivery vs generation components + the unavoidable line items (program charges, wildfire, etc.)."}
        ]
      },

      {
        id:"yucaipa-p4",
        badge:"YUCAIPA • Page 4",
        title:"Yucaipa TOU Bill — Detailed Charges Continued (Page 4)",
        subtitle:"Teach the rep how to read the line items without getting lost (and what actually matters).",
        img:"E808EF5B-CFAA-4900-82AA-3EDA7F11A1F2.jpeg", // <-- change to your repo filename for Yucaipa page 4
        tip:"Rep goal: Don’t read every line—summarize: ‘seasonal rates + fixed recovery + taxes = the total.’",
        callouts:[
          {t:"Energy charges split by season + TOU", d:"This shows how winter vs summer pricing affects totals. Reps should say: ‘Rates change by season and time.’"},
          {t:"Other charges/credits (fixed recovery)", d:"Explain as utility recovery programs; it’s a real line item that can’t be offset by solar credits."},
          {t:"Subtotal + state tax", d:"These lines confirm the math: charges add up to the monthly total."},
          {t:"RIN section (Rate Identification Number)", d:"Not needed for the customer decision—rep should know to skip it unless asked."},
          {t:"‘Things you should know’ section", d:"Usually educational/administrative—don’t spend time here in a first appointment set."}
        ]
      },

      {
        id:"tiered-dcare",
        badge:"TIERS • D-CARE",
        title:"Tiered (D-CARE) Bill — Baseline vs Tier 2 Pain (Page)",
        subtitle:"Teach the rep that the pain here is NOT TOU—it’s total usage pushing into Tier 2 pricing.",
        img:"39500740-8F03-4EA0-963C-A8980F50A563.jpeg", // <-- change to your repo filename for the tiered bill
        tip:"Rep goal: Explain Tier 1 vs Tier 2 simply: ‘The more you use, the more expensive each kWh becomes.’",
        callouts:[
          {t:"Rate plan: D-CARE (tiered structure)", d:"Set context: this is not a TOU explanation—this is tier escalation and baseline limits."},
          {t:"Delivery charges split by Tier 1 and Tier 2", d:"This shows how much kWh fell within baseline vs over baseline. Over baseline drives cost."},
          {t:"Generation charges split by Tier 1 and Tier 2", d:"Even the generation side escalates with tier. More kWh in Tier 2 = higher overall bill."},
          {t:"Total usage + tier allocation box", d:"This is the easiest explanation section: total kWh and how much landed in Tier 2."},
          {t:"Average $/kWh shown for tiers", d:"Use this as the ‘why it’s expensive’ proof: Tier 2 $/kWh is higher."}
        ]
      },

      {
        id:"nem3",
        badge:"NEM 3.0",
        title:"NEM 3.0 (Solar + Battery) — Why You Still See a Bill (Page 3)",
        subtitle:"Teach the rep how to explain imports vs exports and why export value doesn’t always offset peak imports.",
        img:"AC3C10DA-B4AD-4456-B35C-3376F7459D1E.jpeg", // <-- change to your repo filename for the enhanced NEM 3.0 image (ex: NEM3.jpg)
        tip:"Rep goal: Keep it simple: ‘What you buy from the grid’ vs ‘what you send back’ are valued differently by time.",
        callouts:[
          {t:"Usage by TOU bucket (kWh)", d:"Show which bucket is being used. Under NEM 3.0, timing matters a lot more for value."},
          {t:"Avg cost vs total cost", d:"Even a small peak bucket can cost more. This is where customers feel the ‘surprise’."},
          {t:"Imported vs exported totals", d:"Point out: exported kWh can be higher, but that doesn’t guarantee the bill is zero—value is time-based."},
          {t:"Daily average: consumption vs export generation", d:"If consumption grows while export stays flat, the system no longer matches the home."},
          {t:"Details of new charges (delivery/program items)", d:"Even with solar+battery, certain charges remain. Reps should set expectations and then book the consult to model it accurately."}
        ]
      },

      // Quiz slide (auto)
      { id:"quiz", isQuiz:true, badge:"QUIZ", title:"Quick Knowledge Check", subtitle:"Answer these to confirm you can teach the bill correctly. Score 100% to complete.", img:"" }
    ];

    // =========================
    // QUIZ (small test at end)
    // =========================
    // Keep it simple: 6 questions. 100% only if all correct.
    const quiz = [
      {
        q:"On an annual/true-up style bill, which number should the rep point to FIRST to show the real annual risk?",
        choices:[
          "The payment stub amount",
          "The year-to-date charges / annual running total",
          "Only the credit balance line",
          "The utility phone number"
        ],
        a:1
      },
      {
        q:"In TOU bills, what is the fastest way to explain why customers still owe with solar?",
        choices:[
          "Rates are always the same all day",
          "Most expensive usage happens in peak hours when solar produces less",
          "Solar should erase every utility fee",
          "The bill is random"
        ],
        a:1
      },
      {
        q:"What are ‘non-bypassable’ / program-type charges best explained as?",
        choices:[
          "Charges that remain even with solar credits",
          "A mistake that should be removed",
          "Only applicable if you have no solar",
          "A discount"
        ],
        a:0
      },
      {
        q:"On a tiered (D-CARE) bill, the main pain driver is usually:",
        choices:[
          "Peak window 4–9pm",
          "Total kWh pushing into Tier 2 pricing",
          "Export credits by hour",
          "Battery discharge schedule"
        ],
        a:1
      },
      {
        q:"Under NEM 3.0, a customer can export more kWh than they import and still see a bill because:",
        choices:[
          "Exports and imports are valued differently by time",
          "Exports are never counted",
          "Imports are always free",
          "TOU does not exist"
        ],
        a:0
      },
      {
        q:"When a bill shows ‘past due’ plus ‘new charges’, the rep should:",
        choices:[
          "Treat the entire amount as this month’s usage",
          "Separate past due from new charges before explaining solar/usage",
          "Skip the account summary",
          "Only talk about the QR code"
        ],
        a:1
      }
    ];

    // =========================
    // APP
    // =========================
    const nav = document.getElementById('nav');
    const pill = document.getElementById('pill');
    const title = document.getElementById('title');
    const subtitle = document.getElementById('subtitle');
    const badge = document.getElementById('badge');
    const billImg = document.getElementById('billImg');
    const calloutsEl = document.getElementById('callouts');
    const tipEl = document.getElementById('tip');
    const counter = document.getElementById('counter');

    const slideBody = document.getElementById('slideBody');
    const quizBody = document.getElementById('quizBody');
    const openNew = document.getElementById('openNew');
    const openImgBtn = document.getElementById('openImgBtn');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    const jumpQuiz = document.getElementById('jumpQuiz');
    const jumpSlides = document.getElementById('jumpSlides');

    const toggleFocus = document.getElementById('toggleFocus');
    const wrap = document.body;

    const barFill = document.getElementById('barFill');
    const pct = document.getElementById('pct');

    const questionsEl = document.getElementById('questions');
    const gradeQuizBtn = document.getElementById('gradeQuiz');
    const resetQuizBtn = document.getElementById('resetQuiz');
    const quizResult = document.getElementById('quizResult');
    const quizScore = document.getElementById('quizScore');
    const quizPct = document.getElementById('quizPct');

    let idx = 0;

    function el(tag, cls){
      const e = document.createElement(tag);
      if(cls) e.className = cls;
      return e;
    }

    function renderNav(){
      nav.innerHTML = '';
      slides.forEach((s, i) => {
        const b = el('button','navItem' + (i === idx ? ' active' : ''));
        const label = s.isQuiz ? "Quiz" : s.badge;
        const sub = s.isQuiz ? "Score 100% complete" : s.title;
        b.innerHTML = `
          <div>
            <b>${label}</b>
            <small>${sub}</small>
          </div>
          <div class="tag">${i+1}</div>
        `;
        b.addEventListener('click', () => go(i));
        nav.appendChild(b);
      });
      pill.textContent = `${slides.length} total`;
    }

    function renderCallouts(items){
      calloutsEl.innerHTML = '';
      items.forEach((c, i) => {
        const li = el('li','numItem');
        li.innerHTML = `
          <div class="bubble">${i+1}</div>
          <div>
            <b>${c.t}</b>
            <p>${c.d}</p>
          </div>
        `;
        calloutsEl.appendChild(li);
      });
    }

    function go(i){
      idx = Math.max(0, Math.min(slides.length - 1, i));
      const s = slides[idx];

      // update nav active
      Array.from(document.querySelectorAll('.navItem')).forEach((n, ii) => {
        n.classList.toggle('active', ii === idx);
      });

      // toggle slide vs quiz
      if(s.isQuiz){
        slideBody.style.display = 'none';
        quizBody.style.display = '';
        openImgBtn.disabled = true;
        openNew.style.pointerEvents = 'none';
        openNew.style.opacity = .5;

        title.textContent = s.title;
        subtitle.textContent = s.subtitle;
        badge.textContent = s.badge;

        counter.textContent = `Slide ${idx+1} of ${slides.length}`;
        window.scrollTo({top:0, behavior:'smooth'});
        return;
      }

      slideBody.style.display = '';
      quizBody.style.display = 'none';
      openImgBtn.disabled = false;
      openNew.style.pointerEvents = '';
      openNew.style.opacity = 1;

      title.textContent = s.title;
      subtitle.textContent = s.subtitle;
      badge.textContent = s.badge;

      billImg.src = s.img;
      billImg.alt = s.title;

      renderCallouts(s.callouts || []);
      tipEl.textContent = s.tip || '';

      counter.textContent = `Slide ${idx+1} of ${slides.length}`;
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function next(){ go(idx + 1); }
    function prev(){ go(idx - 1); }

    prevBtn.addEventListener('click', prev);
    nextBtn.addEventListener('click', next);

    // open bill in new tab
    function openBill(){
      const s = slides[idx];
      if(!s || s.isQuiz) return;
      window.open(s.img, '_blank');
    }
    openNew.addEventListener('click', openBill);
    openImgBtn.addEventListener('click', openBill);

    // Focus mode
    toggleFocus.addEventListener('click', () => {
      wrap.classList.toggle('focus');
      toggleFocus.textContent = wrap.classList.contains('focus') ? 'Unfocus' : 'Focus';
    });

    // Jump buttons
    jumpQuiz.addEventListener('click', () => go(slides.findIndex(s => s.isQuiz)));
    jumpSlides.addEventListener('click', () => go(0));

    // Swipe for mobile
    let startX = null;
    document.addEventListener('touchstart', (e) => startX = e.changedTouches[0].clientX, {passive:true});
    document.addEventListener('touchend', (e) => {
      if(startX == null) return;
      const dx = e.changedTouches[0].clientX - startX;
      startX = null;
      if(Math.abs(dx) < 70) return;
      if(dx < 0) next(); else prev();
    }, {passive:true});

    // Keyboard
    document.addEventListener('keydown', (e) => {
      if(e.key === 'ArrowRight') next();
      if(e.key === 'ArrowLeft') prev();
    });

    // =========================
    // Quiz rendering + grading
    // =========================
    function renderQuiz(){
      questionsEl.innerHTML = '';
      quiz.forEach((item, qi) => {
        const card = el('div','q');
        const h = el('h4');
        h.textContent = `${qi+1}. ${item.q}`;
        card.appendChild(h);

        const choices = el('div','choices');
        item.choices.forEach((c, ci) => {
          const lab = el('label','choice');
          lab.innerHTML = `
            <input type="radio" name="q${qi}" value="${ci}">
            <span>${c}</span>
          `;
          choices.appendChild(lab);
        });

        card.appendChild(choices);
        questionsEl.appendChild(card);
      });

      setCompletion(0);
      quizResult.classList.remove('ok');
      quizResult.classList.add('bad');
      quizScore.textContent = `0 / ${quiz.length}`;
      quizPct.textContent = `0% complete`;
    }

    function getQuizAnswers(){
      const picked = [];
      for(let i=0;i<quiz.length;i++){
        const sel = document.querySelector(`input[name="q${i}"]:checked`);
        picked.push(sel ? Number(sel.value) : null);
      }
      return picked;
    }

    function gradeQuiz(){
      const picked = getQuizAnswers();
      let correct = 0;
      for(let i=0;i<quiz.length;i++){
        if(picked[i] === quiz[i].a) correct++;
      }
      const percent = Math.round((correct/quiz.length)*100);
      quizScore.textContent = `${correct} / ${quiz.length}`;
      quizPct.textContent = `${percent}% complete`;

      if(percent === 100){
        quizResult.classList.add('ok');
        quizResult.classList.remove('bad');
      }else{
        quizResult.classList.remove('ok');
        quizResult.classList.add('bad');
      }

      setCompletion(percent);
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function resetQuiz(){
      renderQuiz();
      const radios = document.querySelectorAll('input[type="radio"]');
      radios.forEach(r => r.checked = false);
      setCompletion(0);
    }

    function setCompletion(percent){
      barFill.style.width = `${percent}%`;
      pct.textContent = `${percent}%`;
    }

    gradeQuizBtn.addEventListener('click', gradeQuiz);
    resetQuizBtn.addEventListener('click', resetQuiz);

    // Init
    renderNav();
    renderQuiz();
    go(0);

    // Disable Back on first
    function updateButtons(){
      prevBtn.disabled = idx === 0;
      nextBtn.disabled = idx === slides.length - 1;
    }
    const _go = go;
    go = function(i){ _go(i); updateButtons(); };
    updateButtons();
  </script>
</body>
</html>
