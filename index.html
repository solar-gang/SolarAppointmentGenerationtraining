<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>LOS ‚Ä¢ Rep Training Hub</title>
  <meta name="theme-color" content="#0b1017"/>

  <!--
    ‚úÖ Built for your CURRENT repo layout (root files).
    Keep these files in the SAME folder as this index.html:

      Logo.png
      Yucaipa.pdf
      Add-on-bill.pdf
      Laminate-1-2.pdf

    ‚úÖ Add this once in repo root to stop Jekyll build issues:
      .nojekyll   (empty file)
  -->

  <style>
    :root{
      /* Dark theme base */
      --bg:#0b1017;
      --panel:#0f1826;
      --panel2:#0c1522;
      --ink:rgba(255,255,255,.96);
      --muted:rgba(255,255,255,.70);
      --line:rgba(255,255,255,.10);

      /* LOS accents */
      --gold:#FBC909;
      --teal:#3AADBB;
      --cyan:#17B9FF;
      --lime:#9BE63A;

      --shadow: 0 18px 70px rgba(0,0,0,.45);
      --r:16px;
      --r2:22px;

      --safeT: env(safe-area-inset-top);
      --safeB: env(safe-area-inset-bottom);
      --safeL: env(safe-area-inset-left);
      --safeR: env(safe-area-inset-right);
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}
    a{color:inherit}
    .container{
      max-width:1220px;margin:0 auto;
      padding:16px;
      padding-left:calc(16px + var(--safeL));
      padding-right:calc(16px + var(--safeR));
      padding-bottom:calc(16px + var(--safeB));
    }

    /* Topbar */
    .topbar{
      position:sticky;top:0;z-index:50;
      background:rgba(11,16,23,.82);
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--line);
      padding:12px 14px;
      padding-top:calc(12px + var(--safeT));
      display:flex;gap:12px;align-items:center;justify-content:space-between;
    }
    .brand{display:flex;gap:10px;align-items:center;min-width:240px}
    .logo{
      width:44px;height:44px;object-fit:contain;border-radius:12px;
      border:1px solid var(--line);background:rgba(255,255,255,.04)
    }
    .brandTitle{font-weight:950;letter-spacing:.2px}
    .brandSub{font-size:12px;color:var(--muted);margin-top:2px}
    .nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;align-items:center}
    .nav a{
      text-decoration:none;font-size:14px;color:var(--muted);
      padding:9px 12px;border-radius:999px;border:1px solid var(--line);
      background:rgba(255,255,255,.03);white-space:nowrap;
      transition:transform .12s ease,border-color .12s ease,color .12s ease, background .12s ease;
    }
    .nav a:hover{border-color:rgba(255,255,255,.18);color:var(--ink);transform:translateY(-1px);background:rgba(255,255,255,.05)}
    .nav a.active{
      color:var(--ink);
      border-color:rgba(58,173,187,.55);
      box-shadow:0 10px 24px rgba(58,173,187,.12);
      background:rgba(58,173,187,.08);
    }

    /* Hero */
    .hero{
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:var(--r2);
      box-shadow:var(--shadow);
      padding:16px;
      background:
        radial-gradient(1100px 520px at 12% 0%, rgba(251,201,9,.18), transparent 55%),
        radial-gradient(900px 520px at 88% 10%, rgba(58,173,187,.16), transparent 55%),
        linear-gradient(135deg, rgba(251,201,9,.08), rgba(58,173,187,.06));
    }
    .hero h1{margin:0 0 8px;font-size:24px}
    .hero p{margin:0;color:var(--muted);line-height:1.45}
    .pillRow{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    .pill{font-size:12px;padding:7px 10px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.03);color:var(--muted)}

    /* Cards */
    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:12px;
    }
    .card{
      grid-column:span 12;
      border:1px solid var(--line);
      border-radius:var(--r2);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow:var(--shadow);
      padding:14px;
    }
    .cardHeader{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .cardTitle{font-weight:950;margin:0;font-size:18px}
    .tag{
      font-size:12px;color:var(--muted);
      border:1px solid var(--line);
      border-radius:999px;padding:7px 10px;background:rgba(255,255,255,.03);white-space:nowrap;
    }
    .cardText{color:var(--muted);line-height:1.45;margin-top:8px}
    .divider{height:1px;background:var(--line);margin:12px 0}

    /* Viewer + right panel */
    .viewerWrap{display:grid;gap:12px}
    .viewerHeader{
      display:flex;flex-wrap:wrap;gap:10px;
      align-items:center;justify-content:space-between;
    }
    .selectRow{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    select{
      appearance:none;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      background:rgba(255,255,255,.03);
      color:var(--ink);
      box-shadow:0 8px 18px rgba(0,0,0,.25);
    }
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--ink);
      padding:10px 12px;
      border-radius:12px;
      font-weight:900;
      cursor:pointer;
      box-shadow:0 8px 18px rgba(0,0,0,.25);
      transition:transform .12s ease, border-color .12s ease, background .12s ease;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.05)}
    .btnPrimary{
      background:linear-gradient(135deg,var(--gold),var(--teal));
      border-color:transparent;
      color:#06122a;
    }
    .btnSmall{padding:8px 10px;border-radius:10px;font-weight:900}

    .pageRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input[type="range"]{width:220px;max-width:70vw}
    .pagePill{
      font-size:12px;color:var(--muted);
      border:1px solid var(--line);
      border-radius:999px;padding:7px 10px;background:rgba(255,255,255,.03);white-space:nowrap;
    }

    .pdfShell{
      border:1px solid var(--line);
      border-radius:var(--r2);
      overflow:hidden;
      background:#000;
      box-shadow:var(--shadow);
      height:62vh;min-height:420px;
    }
    .pdfShell iframe{width:100%;height:100%;border:0;background:#000}

    .side{
      border:1px solid var(--line);
      border-radius:var(--r2);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow:var(--shadow);
      padding:14px;
    }
    .side h3{margin:0 0 6px;font-size:16px}
    .side p{margin:0;color:var(--muted);line-height:1.45}
    .list{margin:10px 0 0 0;padding:0;list-style:none;display:grid;gap:10px}
    .item{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:
        radial-gradient(600px 220px at 0% 0%, rgba(251,201,9,.10), transparent 55%),
        radial-gradient(600px 220px at 100% 0%, rgba(58,173,187,.08), transparent 55%),
        rgba(255,255,255,.02);
    }
    .item b{color:var(--ink)}
    .item small{display:block;color:var(--muted);margin-top:6px;line-height:1.35}

    details.training{
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(255,255,255,.02);
      overflow:hidden;
    }
    details.training + details.training{margin-top:10px}
    details.training summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      display:flex;gap:10px;align-items:flex-start;justify-content:space-between;
      user-select:none;
      font-weight:950;
      color:var(--ink);
    }
    details.training summary::-webkit-details-marker{display:none}
    .left{display:flex;gap:10px;align-items:flex-start}
    .dot{
      width:10px;height:10px;border-radius:999px;margin-top:5px;
      background:linear-gradient(135deg,var(--gold),var(--teal));
      box-shadow:0 10px 20px rgba(58,173,187,.14);
      flex:0 0 auto;
    }
    .caret{
      width:10px;height:10px;border-right:2px solid rgba(255,255,255,.45);border-bottom:2px solid rgba(255,255,255,.45);
      transform:rotate(45deg);
      margin-top:6px;
      transition:transform .12s ease;
      flex:0 0 auto;
    }
    details[open] .caret{transform:rotate(225deg);margin-top:10px}
    .body{padding:0 12px 12px 12px;color:var(--muted);line-height:1.45}
    .body ul{margin:8px 0 0 18px}
    .body li{margin:7px 0}

    .calcGrid{display:grid;gap:10px;margin-top:10px}
    .calcRow{display:grid;gap:10px}
    .field{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,.03);
      box-shadow:0 8px 18px rgba(0,0,0,.25);
    }
    .field label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;font-weight:900;letter-spacing:.02em}
    .field input{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 12px;
      font-size:16px;
      outline:none;
      color:var(--ink);
      background:rgba(255,255,255,.02);
    }
    .result{
      border:1px solid rgba(155,230,58,.35);
      background:rgba(155,230,58,.10);
      border-radius:14px;
      padding:12px;
      font-weight:950;
    }
    .result .big{font-size:22px}
    .mini{font-size:12px;color:var(--muted);font-weight:800;margin-top:6px;line-height:1.35}

    .script{
      border:1px dashed rgba(58,173,187,.55);
      background:rgba(58,173,187,.10);
      border-radius:14px;
      padding:12px;
      margin-top:12px;
      color:var(--ink);
      line-height:1.45;
    }
    .script strong{display:block;margin-bottom:6px}
    .kbd{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      font-size:12px;
      padding:2px 7px;border:1px solid var(--line);border-radius:8px;background:rgba(255,255,255,.03);color:var(--muted)
    }

    .footer{
      margin:16px 0 10px;
      color:var(--muted);
      font-size:12px;
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    }

    @media (min-width: 980px){
      .hero h1{font-size:30px}
      .viewerWrap{grid-template-columns: 7fr 5fr;align-items:start}
      .pdfShell{height:70vh;min-height:520px}
      .calcRow{grid-template-columns:1fr 1fr}
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <img src="Logo.png" class="logo" alt="Leverage Our Sun"/>
      <div>
        <div class="brandTitle">LOS Rep Training Hub</div>
        <div class="brandSub">Win the day ‚Ä¢ Own the night</div>
      </div>
    </div>

    <nav class="nav" id="nav">
      <a href="#bill" class="active">Bill Knowledge</a>
      <a href="#approach">Door Approach</a>
      <a href="#growth">Self Growth</a>
      <a href="#kwh">$/kWh</a>
    </nav>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Make the bill simple (and fun).</h1>
      <p>
        Teach the bill in 60 seconds, earn the sit-down, and build trust.
        Use the viewer + callouts, then schedule a <span class="kbd">30‚Äì45 min</span> consult to verify savings.
      </p>
      <div class="pillRow">
        <span class="pill">Same window viewer</span>
        <span class="pill">Non-solar + solar</span>
        <span class="pill">Practice scripts</span>
      </div>
    </section>

    <section class="grid">
      <!-- BILL VIEWER -->
      <section class="card" id="bill">
        <div class="cardHeader">
          <h2 class="cardTitle">Bill Knowledge / Problem</h2>
          <span class="tag">Teach ‚Üí Transition ‚Üí Book</span>
        </div>
        <p class="cardText">
          Choose a training bill below. These names are rep-friendly.
          All PDFs load inside the viewer‚Äîno leaving the page.
        </p>

        <div class="divider"></div>

        <div class="viewerWrap">
          <!-- LEFT -->
          <div>
            <div class="viewerHeader">
              <div class="selectRow">
                <select id="billSelect" aria-label="Choose bill PDF">
                  <option value="Yucaipa.pdf" data-pages="6" selected>TOU ‚Äì Domestic</option>
                  <option value="Add-on-bill.pdf" data-pages="3">NEM 2.0 (Solar)</option>
                  <option value="Laminate-1-2.pdf" data-pages="2">NEM 3.0 (Solar)</option>
                </select>
                <span class="pagePill">Viewer stays on this page</span>
              </div>

              <div class="controls">
                <button class="btn btnSmall" id="openNew" title="Optional: open PDF in a new tab">Open</button>
                <button class="btn btnSmall" id="prevBtn">Prev</button>
                <button class="btn btnSmall btnPrimary" id="nextBtn">Next</button>
              </div>
            </div>

            <div class="divider"></div>

            <div class="pageRow">
              <span class="pagePill">Page <b id="pageNum">1</b> / <b id="pageMax">6</b></span>
              <input type="range" id="pageSlider" min="1" max="6" value="1"/>
              <button class="btn btnSmall" id="fitBtn" title="Toggle zoom mode">Fit</button>
            </div>

            <div class="divider"></div>

            <div class="pdfShell">
              <iframe id="pdfFrame" title="Bill PDF Viewer"></iframe>
            </div>

            <div class="script">
              <strong>60-second talk track (copy/paste):</strong>
              ‚ÄúYour bill is expensive for two reasons: <b>how much</b> you use and <b>when</b> you use it.
              Peak hours cost more. My job is to see if solar (and maybe a battery) gives you
              <b>day-one savings</b>. If it doesn‚Äôt, we stop there. Would you prefer
              <span class="kbd">today</span> or <span class="kbd">tomorrow</span> for a quick consult?‚Äù
            </div>
          </div>

          <!-- RIGHT -->
          <aside class="side">
            <h3>What to point at (changes by page)</h3>
            <p id="calloutIntro">Select a bill + page. The callouts below update automatically.</p>
            <ul class="list" id="calloutList"></ul>

            <div class="divider"></div>

            <h3 style="margin:0 0 6px">Goal by home type</h3>
            <div class="item">
              <b>No solar</b>
              <small>Teach usage + TOU + where charges come from ‚Üí schedule consult to verify savings.</small>
            </div>
            <div class="item">
              <b>Has solar (still paying)</b>
              <small>Teach TOU + true-up + peak buying ‚Üí position batteries as ‚Äúcontrolled peak buying.‚Äù</small>
            </div>
          </aside>
        </div>
      </section>

      <!-- DOOR APPROACH -->
      <section class="card" id="approach">
        <div class="cardHeader">
          <h2 class="cardTitle">Door Approach</h2>
          <span class="tag">Confidence + pace</span>
        </div>
        <p class="cardText">Your job isn‚Äôt to ‚Äúwin the whole deal‚Äù at the door‚Äîjust earn the sit-down.</p>

        <details class="training" open>
          <summary>
            <span class="left"><span class="dot"></span>Structure: Intro ‚Üí Problem ‚Üí Solution ‚Üí Takeaways ‚Üí Transition ‚Üí Assume sale</span>
            <span class="caret"></span>
          </summary>
          <div class="body">
            <ul>
              <li><b>Intro:</b> ‚ÄúHi, I‚Äôm Carlos‚Äîmy team‚Äôs doing the power projects out here.‚Äù</li>
              <li><b>Problem:</b> ‚ÄúRates are rising and peak hours cost more.‚Äù</li>
              <li><b>Solution:</b> ‚ÄúSolar offsets usage. Batteries protect peak + outages.‚Äù</li>
              <li><b>Takeaways:</b> ‚ÄúIf it doesn‚Äôt save day one, we stop.‚Äù</li>
              <li><b>Transition:</b> ‚ÄúLet‚Äôs verify with your bill + usage.‚Äù</li>
              <li><b>Assume sale:</b> ‚ÄúToday at 6:30 or tomorrow at 4?‚Äù</li>
            </ul>
          </div>
        </details>

        <details class="training">
          <summary>
            <span class="left"><span class="dot"></span>Tone + pace (easy yes)</span>
            <span class="caret"></span>
          </summary>
          <div class="body">
            <ul>
              <li>Slow down 10‚Äì15% (sounds confident, not pushy).</li>
              <li>Short sentences. One point at a time.</li>
              <li>Downward tone for certainty, upward tone only on questions.</li>
              <li>Pause after questions‚Äîlet them answer.</li>
            </ul>
          </div>
        </details>

        <details class="training">
          <summary>
            <span class="left"><span class="dot"></span>Body language (trust)</span>
            <span class="caret"></span>
          </summary>
          <div class="body">
            <ul>
              <li>Hands visible, relaxed. No fast gestures.</li>
              <li>Stand at an angle (less aggressive). Give space.</li>
              <li>Eye contact when asking, softer eyes when listening.</li>
            </ul>
          </div>
        </details>

        <details class="training">
          <summary>
            <span class="left"><span class="dot"></span>Prospecting homes (where to knock)</span>
            <span class="caret"></span>
          </summary>
          <div class="body">
            <ul>
              <li>EVs, pools, hot tubs, additions, big family homes.</li>
              <li>Solar installed but still paying? That‚Äôs a <b>battery conversation</b>.</li>
            </ul>
          </div>
        </details>

        <div class="script">
          <strong>Mini-game (fun):</strong>
          Get 3 ‚ÄúYES‚Äù moments per hour:
          <span class="kbd">Yes, I pay online</span> ‚Ä¢ <span class="kbd">Yes, I‚Äôll grab my bill</span> ‚Ä¢ <span class="kbd">Yes, schedule a consult</span>
        </div>
      </section>

      <!-- SELF GROWTH -->
      <section class="card" id="growth">
        <div class="cardHeader">
          <h2 class="cardTitle">Self Growth</h2>
          <span class="tag">Discipline wins</span>
        </div>
        <p class="cardText">Great reps become disciplined people. Build routine ‚Üí routine builds results.</p>

        <details class="training" open>
          <summary>
            <span class="left"><span class="dot"></span>Daily (15 minutes)</span>
            <span class="caret"></span>
          </summary>
          <div class="body">
            <ul>
              <li>5 min: repeat the talk track out loud.</li>
              <li>5 min: read one bill page + explain it in plain English.</li>
              <li>5 min: plan your best streets.</li>
            </ul>
          </div>
        </details>

        <details class="training">
          <summary>
            <span class="left"><span class="dot"></span>Weekly (level up)</span>
            <span class="caret"></span>
          </summary>
          <div class="body">
            <ul>
              <li>Record yourself once per week (intro + close).</li>
              <li>Role-play objections (10 minutes).</li>
              <li>Review your best conversations and copy what worked.</li>
            </ul>
          </div>
        </details>
      </section>

      <!-- $/KWH -->
      <section class="card" id="kwh">
        <div class="cardHeader">
          <h2 class="cardTitle">$/kWh Quick Calculator</h2>
          <span class="tag">Teach it fast</span>
        </div>
        <p class="cardText">Explain in one line: ‚ÄúYou‚Äôre paying about <b>$X per kWh</b> right now.‚Äù</p>

        <div class="calcGrid">
          <div class="calcRow">
            <div class="field">
              <label>Monthly bill amount ($)</label>
              <input id="billAmount" inputmode="decimal" placeholder="Example: 333.92"/>
            </div>
            <div class="field">
              <label>Monthly usage (kWh)</label>
              <input id="kwhUsage" inputmode="decimal" placeholder="Example: 1258"/>
            </div>
          </div>

          <button class="btn btnPrimary" id="calcBtn" style="width:100%">Calculate $/kWh</button>

          <div class="result" id="calcOut">
            <div class="big">Enter bill + kWh</div>
            <div class="mini">Tip: pull ‚ÄúTotal usage (kWh)‚Äù from the bill.</div>
          </div>
        </div>
      </section>
    </section>

    <div class="footer">
      <div>¬© Leverage Our Sun ‚Ä¢ Training Hub</div>
      <div>Uses: Logo.png ‚Ä¢ Yucaipa.pdf ‚Ä¢ Add-on-bill.pdf ‚Ä¢ Laminate-1-2.pdf</div>
    </div>
  </main>

  <script>
    // ‚úÖ Callouts per PDF + page
    const CALLOUTS = {
      "Yucaipa.pdf": {
        intro: "TOU ‚Äì Domestic (no solar). Focus: Usage ‚Üí TOU (when) ‚Üí Delivery vs Generation (where charges come from).",
        pages: {
          1: [
            ["Rate plan / TOU basics", "Teach: it‚Äôs not just how much‚Äîit‚Äôs WHEN."],
            ["Messaging", "Look for plan notes, baseline, or important notices."]
          ],
          2: [
            ["Usage trend", "Connect EV/pool/AC to higher usage."],
            ["Total kWh", "Drives system size + savings math."]
          ],
          3: [
            ["Delivery vs Generation", "Two buckets. Both rise."],
            ["Why it feels expensive", "Delivery = wires/programs. Generation = energy."]
          ],
          4: [
            ["Peak vs off-peak", "Battery story: controlled peak buying."],
            ["Behavior link", "4‚Äì9pm habits create peak pain."]
          ],
          5: [
            ["Amount due", "What they pay today is the pain you solve."],
            ["Adjustments", "Mention briefly‚Äîdon‚Äôt overwhelm."]
          ],
          6: [
            ["Summary notes", "Baseline allowance and program notes often live here."]
          ]
        }
      },
      "Add-on-bill.pdf": {
        intro: "NEM 2.0 (Solar). Focus: credits vs charges + true-up + why batteries stop peak buying.",
        pages: {
          1: [
            ["True-up concept", "Annual settlement can make months look weird."],
            ["Minimum charges", "Even with solar, minimums may apply."]
          ],
          2: [
            ["Credits vs charges", "Exports credit, imports charge‚ÄîTOU decides value."],
            ["Peak buying", "Solar alone may not protect peak hours."]
          ],
          3: [
            ["Big takeaway", "Batteries = controlled peak buying + outage protection."]
          ]
        }
      },
      "Laminate-1-2.pdf": {
        intro: "NEM 3.0 (Solar). Use as quick reference + practice.",
        pages: {
          1: [
            ["Definitions", "TOU, usage, delivery vs generation‚Äîsimple one-liners."],
            ["Close", "Practice two-option close."]
          ],
          2: [
            ["Objections", "Short answers that lead to the consult."]
          ]
        }
      }
    };

    const billSelect   = document.getElementById("billSelect");
    const pdfFrame     = document.getElementById("pdfFrame");
    const pageNumEl    = document.getElementById("pageNum");
    const pageMaxEl    = document.getElementById("pageMax");
    const slider       = document.getElementById("pageSlider");
    const prevBtn      = document.getElementById("prevBtn");
    const nextBtn      = document.getElementById("nextBtn");
    const openNew      = document.getElementById("openNew");
    const fitBtn       = document.getElementById("fitBtn");
    const calloutIntro = document.getElementById("calloutIntro");
    const calloutList  = document.getElementById("calloutList");

    // Fix for iOS/Safari not updating PDF when only hash changes:
    // We force reload by setting src to "about:blank" first, then set actual URL.
    let fitMode = true;
    let lastSrc = "";

    function getMaxPages(){
      const opt = billSelect.options[billSelect.selectedIndex];
      const n = parseInt(opt.getAttribute("data-pages") || "1", 10);
      return isNaN(n) ? 1 : n;
    }

    function buildPdfUrl(file, page){
      const zoom = fitMode ? "&zoom=page-width" : "";
      // cache buster so next/prev always refreshes in Safari
      const bust = `&t=${Date.now()}`;
      return `${file}#page=${page}${zoom}${bust}`;
    }

    function setCallouts(file, page){
      calloutList.innerHTML = "";
      const data = CALLOUTS[file];
      if(!data){
        calloutIntro.textContent = "No callouts configured for this file yet.";
        return;
      }
      calloutIntro.textContent = data.intro || "Use the callouts to teach the bill.";
      const list = (data.pages && data.pages[page]) ? data.pages[page] : [];
      if(list.length === 0){
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `<b>No specific callouts for this page</b><small>Point out usage, TOU, tiers, and where charges come from.</small>`;
        calloutList.appendChild(li);
        return;
      }
      list.forEach(([title, desc])=>{
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `<b>${title}</b><small>${desc}</small>`;
        calloutList.appendChild(li);
      });
    }

    function forceSetIframeSrc(src){
      if(src === lastSrc) return;
      lastSrc = src;
      pdfFrame.src = "about:blank";
      // small delay ensures Safari/iOS resets the iframe
      setTimeout(()=>{ pdfFrame.src = src; }, 35);
    }

    function loadPdf(){
      const file = billSelect.value;
      const max = getMaxPages();
      const page = Math.min(parseInt(slider.value,10) || 1, max);

      pageNumEl.textContent = String(page);
      pageMaxEl.textContent = String(max);
      slider.max = String(max);
      slider.value = String(page);

      const src = buildPdfUrl(file, page);
      forceSetIframeSrc(src);
      setCallouts(file, page);

      openNew.onclick = () => window.open(src, "_blank", "noopener");
    }

    function setPage(p){
      const max = getMaxPages();
      const page = Math.max(1, Math.min(max, p));
      slider.value = String(page);
      loadPdf();
    }

    billSelect.addEventListener("change", ()=>{ slider.value="1"; lastSrc=""; loadPdf(); });
    slider.addEventListener("input", ()=>{ lastSrc=""; loadPdf(); });
    prevBtn.addEventListener("click", ()=> setPage((parseInt(slider.value,10)||1)-1));
    nextBtn.addEventListener("click", ()=> setPage((parseInt(slider.value,10)||1)+1));
    fitBtn.addEventListener("click", ()=>{
      fitMode = !fitMode;
      fitBtn.textContent = fitMode ? "Fit" : "Zoom";
      lastSrc="";
      loadPdf();
    });

    // $/kWh calculator
    const billAmount = document.getElementById("billAmount");
    const kwhUsage   = document.getElementById("kwhUsage");
    const calcBtn    = document.getElementById("calcBtn");
    const calcOut    = document.getElementById("calcOut");

    function calcKwh(){
      const b = parseFloat((billAmount.value || "").replace(/[^0-9.]/g,""));
      const k = parseFloat((kwhUsage.value || "").replace(/[^0-9.]/g,""));
      if(!isFinite(b) || !isFinite(k) || b<=0 || k<=0){
        calcOut.innerHTML = `<div class="big">Enter valid numbers</div><div class="mini">Example: $333.92 and 1258 kWh</div>`;
        return;
      }
      const p = b / k;
      const nice = p.toFixed(2);

      let vibe = "Solid.";
      if(p >= 0.40) vibe = "üî• High. Peak hours are crushing them.";
      else if(p >= 0.30) vibe = "‚ö° Elevated. TOU + delivery charges add up.";
      else vibe = "‚úÖ Manageable, but rates usually rise.";

      calcOut.innerHTML =
        `<div class="big">$${nice} <span style="font-weight:950">per kWh</span></div>
         <div class="mini">${vibe} Teach: ‚ÄúYou‚Äôre paying about <b>$${nice}</b> for every kWh you use.‚Äù</div>`;
    }

    calcBtn.addEventListener("click", calcKwh);

    // Nav highlight
    const sections = ["bill","approach","growth","kwh"].map(id => document.getElementById(id));
    const links = Array.from(document.querySelectorAll("#nav a"));
    const setActive = (hash)=> links.forEach(a => a.classList.toggle("active", a.getAttribute("href")===hash));

    const obs = new IntersectionObserver((entries)=>{
      const visible = entries.filter(e=>e.isIntersecting).sort((a,b)=>b.intersectionRatio-a.intersectionRatio)[0];
      if(!visible) return;
      setActive("#"+visible.target.id);
    }, { rootMargin: "-45% 0px -50% 0px", threshold:[0.1,0.2,0.3,0.4,0.5] });

    sections.forEach(s => s && obs.observe(s));

    // Init
    loadPdf();
  </script>
</body>
</html>
